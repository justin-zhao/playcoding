cscope 15 $HOME/playcoding -q 0000000203 0000021414
	@back.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<gtk/gtk.h
>

4 
	~<m©h.h
>

5 
	~<sigÇl.h
>

6 
	~<time.h
>

7 
	~<sys/time.h
>

9 
	#MYRGB
(
R
,
G
,
B
è()((R&0xFF)<<16|(G&0xFF)<<8|(B&0xFF))

	)

10 
	#FETCHR
(
þr
è()(((þr>>16)&0xFF)/255.0)

	)

11 
	#FETCHG
(
þr
è()(((þr>>8)&0xFF)/255.0)

	)

12 
	#FETCHB
(
þr
è()((þr&0xFF)/255.0)

	)

14 
	s_BALL
{

15 
	mx
, 
	my
, 
	mr
;

16 
	mwidth
;

17 
	mþr
;

18 } 
	tT_BALL
;

20 
GtkWidg‘
 *
	gpD¿w
 = 
NULL
;

21 
T_BALL
 *
	gpB®l1
 = 
NULL
;

22 
	gsü_width
 = 0;

23 
	gsü_height
 = 0;

24 
	g¥“dx
=5;

25 
	g¥“dy
=3;

28 
ÿœo_surçû_t
 *
	gsurçû
 = 
NULL
;

31 
	$þ—r_surçû
 ()

33 
ÿœo_t
 *
ü
;

35 
ü
 = 
	`ÿœo_ü—‹
 (
surçû
);

37 
	`ÿœo_£t_sourû_rgb
 (
ü
, 1, 1, 1);

38 
	`ÿœo_·št
 (
ü
);

40 
	`ÿœo_de¡roy
 (
ü
);

41 
	}
}

44 
gboÞ—n


45 
	$cÚfigu»_ev’t_cb
 (
GtkWidg‘
 *
widg‘
,

46 
GdkEv’tCÚfigu»
 *
ev’t
,

47 
gpoš‹r
 
d©a
)

49 ià(
surçû
)

50 
	`ÿœo_surçû_de¡roy
 (
surçû
);

52 
sü_width
 = 
	`gtk_widg‘_g‘_®loÿ‹d_width
 (
widg‘
);

53 
sü_height
 = 
	`gtk_widg‘_g‘_®loÿ‹d_height
 (
widg‘
);

54 
surçû
 = 
	`gdk_wšdow_ü—‹_simž¬_surçû
 (
	`gtk_widg‘_g‘_wšdow
 (
widg‘
),

55 
CAIRO_CONTENT_COLOR
,

56 
sü_width
,

57 
sü_height
);

60 
	`þ—r_surçû
 ();

63  
TRUE
;

64 
	}
}

70 
gboÞ—n


71 
	$d¿w_cb
 (
GtkWidg‘
 *
widg‘
,

72 
ÿœo_t
 *
ü
,

73 
gpoš‹r
 
d©a
)

75 
	`ÿœo_£t_sourû_surçû
 (
ü
, 
surçû
, 0, 0);

76 
	`ÿœo_·št
 (
ü
);

78  
FALSE
;

79 
	}
}

83 
	$d¿w_brush
 (
GtkWidg‘
 *
widg‘
,

84 
gdoubË
 
x
,

85 
gdoubË
 
y
)

87 
ÿœo_t
 *
ü
;

90 
ü
 = 
	`ÿœo_ü—‹
 (
surçû
);

93 
	`ÿœo_£t_sourû_rgb
(
ü
, 0.0, 0.0, 1.0);

97 
	`ÿœo_£t_lše_width
 (
ü
, 2);

101 
	`ÿœo_¬c
 (
ü
, 
x
, 
y
, 10, 0, 2 * 
M_PI
);

102 
	`ÿœo_¡roke
 (
ü
);

107 
	`ÿœo_de¡roy
 (
ü
);

110 
	`gtk_widg‘_queue_d¿w_¬—
 (
widg‘
, 
x
 - 40, 
y
 - 40, 80, 80);

111 
	}
}

118 
gboÞ—n


119 
	$bu‰Ú_´ess_ev’t_cb
 (
GtkWidg‘
 *
widg‘
,

120 
GdkEv’tBu‰Ú
 *
ev’t
,

121 
gpoš‹r
 
d©a
)

124 ià(
surçû
 =ð
NULL
)

125  
FALSE
;

127 
	`´štf
("Bu‰Ú=%d\r\n", 
ev’t
->
bu‰Ú
);

128 ià(
ev’t
->
bu‰Ú
 =ð
GDK_BUTTON_PRIMARY
)

130 
	`d¿w_brush
 (
widg‘
, 
ev’t
->
x
,ƒv’t->
y
);

132 ià(
ev’t
->
bu‰Ú
 =ð
GDK_BUTTON_SECONDARY
)

134 
	`þ—r_surçû
 ();

135 
	`gtk_widg‘_queue_d¿w
 (
widg‘
);

139  
TRUE
;

140 
	}
}

146 
gboÞ—n


147 
	$mÙiÚ_nÙify_ev’t_cb
 (
GtkWidg‘
 *
widg‘
,

148 
GdkEv’tMÙiÚ
 *
ev’t
,

149 
gpoš‹r
 
d©a
)

152 ià(
surçû
 =ð
NULL
)

153  
FALSE
;

155 ià(
ev’t
->
¡©e
 & 
GDK_BUTTON1_MASK
)

156 
	`d¿w_brush
 (
widg‘
, 
ev’t
->
x
,ƒv’t->
y
);

159  
TRUE
;

160 
	}
}

163 
	$þo£_wšdow
 ()

165 ià(
surçû
)

166 
	`ÿœo_surçû_de¡roy
 (
surçû
);

168 
	`gtk_maš_qu™
 ();

169 
	}
}

171 
gboÞ—n


172 
	$Ú_key_´ess
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tKey
 *
ev’t
, 
gpoš‹r
 
u£r_d©a
)

174 
	`´štf
("Key…»s£d: %d\r\n", 
ev’t
->
keyv®
);

177 ià(
ev’t
->
keyv®
 == 65362)

178 
¥“dy
--;

179 ià(
ev’t
->
keyv®
 == 65364)

180 
¥“dy
++;

182 ià(
ev’t
->
keyv®
 == 65361)

183 
¥“dx
--;

184 ià(
ev’t
->
keyv®
 == 65363)

185 
¥“dx
++;

187  
TRUE
;

188 
	}
}

191 
	$aùiv©e
 (
GtkAµliÿtiÚ
 *
­p
,

192 
gpoš‹r
 
u£r_d©a
)

194 
GtkWidg‘
 *
wšdow
;

195 
GtkWidg‘
 *
äame
;

196 
GtkWidg‘
 *
d¿wšg_¬—
;

198 
wšdow
 = 
	`gtk_­¶iÿtiÚ_wšdow_Ãw
 (
­p
);

199 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
wšdow
), "Drawing Area");

201 
	`g_sigÇl_cÚÃù
 (
wšdow
, "de¡roy", 
	`G_CALLBACK
 (
þo£_wšdow
), 
NULL
);

202 
	`g_sigÇl_cÚÃù
 (
wšdow
, "key_´ess_ev’t", 
	`G_CALLBACK
 (
Ú_key_´ess
), 
NULL
);

204 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
wšdow
), 4);

206 
äame
 = 
	`gtk_äame_Ãw
 (
NULL
);

207 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame
), 
GTK_SHADOW_IN
);

208 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
wšdow
), 
äame
);

210 
d¿wšg_¬—
 = 
	`gtk_d¿wšg_¬—_Ãw
 ();

212 
	`gtk_widg‘_£t_size_»que¡
 (
d¿wšg_¬—
, 800, 600);

214 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame
), 
d¿wšg_¬—
);

217 
	`g_sigÇl_cÚÃù
 (
d¿wšg_¬—
, "draw",

218 
	`G_CALLBACK
 (
d¿w_cb
), 
NULL
);

219 
	`g_sigÇl_cÚÃù
 (
d¿wšg_¬—
,"configure-event",

220 
	`G_CALLBACK
 (
cÚfigu»_ev’t_cb
), 
NULL
);

223 
	`g_sigÇl_cÚÃù
 (
d¿wšg_¬—
, "motion-notify-event",

224 
	`G_CALLBACK
 (
mÙiÚ_nÙify_ev’t_cb
), 
NULL
);

225 
	`g_sigÇl_cÚÃù
 (
d¿wšg_¬—
, "button-press-event",

226 
	`G_CALLBACK
 (
bu‰Ú_´ess_ev’t_cb
), 
NULL
);

227 
pD¿w
 = 
d¿wšg_¬—
;

234 
	`gtk_widg‘_£t_ev’ts
 (
d¿wšg_¬—
, 
	`gtk_widg‘_g‘_ev’ts
 (drawing_area)

235 | 
GDK_BUTTON_PRESS_MASK


236 | 
GDK_POINTER_MOTION_MASK
);

238 
	`gtk_widg‘_show_®l
 (
wšdow
);

239 
	}
}

241 
	$b®l_show
(
T_BALL
 *
pB®l
)

243 ià(!
pD¿w
 || !
pB®l
 || !
surçû
)

246 
ÿœo_t
 *
ü
;

249 
ü
 = 
	`ÿœo_ü—‹
 (
surçû
);

251 
	`ÿœo_£t_sourû_rgb
(
ü
, 
	`FETCHR
(
pB®l
->
þr
), 
	`FETCHG
ÕB®l->þr), 
	`FETCHB
(pBall->clr));

252 
	`ÿœo_£t_lše_width
 (
ü
, 
pB®l
->
width
);

254 
	`ÿœo_¬c
 (
ü
, 
pB®l
->
x
,…B®l->
y
,…B®l->
r
, 0, 2 * 
M_PI
);

255 
	`ÿœo_¡roke
 (
ü
);

257 
	`ÿœo_de¡roy
 (
ü
);

260 
	`gtk_widg‘_queue_d¿w_¬—
 (
pD¿w
, 
pB®l
->
x
 -…B®l->
r
 -…B®l->
width
,…B®l->
y
 -…Ball->r -…Ball->width,

261 2*(
pB®l
->
r
 +…B®l->
width
), 2*(pBall->r +…Ball->width));

262 
	}
}

264 
	$b®l_move
(
T_BALL
 *
pB®l
, 
x
, 
y
)

266 
Þdþr
;

268 ià(!
pB®l
)

271 
Þdþr
 = 
pB®l
->
þr
;

272 
pB®l
->
þr
 = 
	`MYRGB
(255,255,255);

273 
pB®l
->
width
 =…Ball->width + 1;

274 
	`b®l_show
(
pB®l
);

276 
pB®l
->
x
 = x;

277 
pB®l
->
y
 = y;

278 
pB®l
->
width
 =…Ball->width - 1;

279 
pB®l
->
þr
 = 
Þdþr
;

280 
	`b®l_show
(
pB®l
);

281 
	}
}

283 
T_BALL
 *
	$b®l_š™
(
x
, 
y
, 
r
, 
þr
)

285 
T_BALL
 *
pB®l
;

287 
pB®l
 = 
	`m®loc
((
T_BALL
));

289 
pB®l
->
x
 = x;

290 
pB®l
->
y
 = y;

291 
pB®l
->
r
 =„;

292 
pB®l
->
þr
 = clr;

293 
pB®l
->
width
 = 2;

295  
pB®l
;

296 
	}
}

298 
	$b®l_de¡roy
(
T_BALL
 *
pB®l
)

300 
	`ä“
(
pB®l
);

301 
	}
}

303 
	$sigroutše
(
signo
)

305 
x
, 
y
;

307 ià(
sü_width
 < 1 || 
sü_height
 < 1)

310 
signo
)

312 
SIGALRM
:

313 ià(
pB®l1
)

315 
x
 = 
pB®l1
->x + 
¥“dx
;

316 
y
 = 
pB®l1
->y + 
¥“dy
;

317 ià(
x
 > 
sü_width
)

319 
¥“dx
 = 0-speedx;

320 
x
 = 
sü_width
 - x%scr_width;

323 ià(
x
 < 0)

325 
¥“dx
 = 0-speedx;

326 
x
 = -x;

329 ià(
y
 > 
sü_height
)

331 
¥“dy
 = 0-speedy;

332 
y
 = 
sü_height
 - y%scr_height;

335 ià(
y
 < 0)

337 
¥“dy
 = 0-speedy;

338 
y
 = -y;

341 
	`b®l_move
(
pB®l1
, 
x
, 
y
);

345 
	}
}

348 
	$maš
 (
¬gc
,

349 **
¬gv
)

351 
GtkAµliÿtiÚ
 *
­p
;

352 
¡©us
;

353 
T_BALL
 *
‹mp
;

354 
™im”v®
 
tim”v
, 
tim”o
;

356 
­p
 = 
	`gtk_­¶iÿtiÚ_Ãw
 ("Üg.gtk.exam¶e", 
G_APPLICATION_FLAGS_NONE
);

357 
	`g_sigÇl_cÚÃù
 (
­p
, "aùiv©e", 
	`G_CALLBACK
 (
aùiv©e
), 
NULL
);

359 
pB®l1
 = 
	`b®l_š™
(100, 100, 10, 
	`MYRGB
(255,0,0));

360 
	`sigÇl
(
SIGALRM
, 
sigroutše
);

361 
tim”v
.
™_v®ue
.
tv_£c
 = 0;

362 
tim”v
.
™_v®ue
.
tv_u£c
 = 40000;

363 
tim”v
.
™_š‹rv®
.
tv_£c
 = 0;

364 
tim”v
.
™_š‹rv®
.
tv_u£c
 = 40000;

365 
	`£t™im”
(
ITIMER_REAL
, &
tim”v
, &
tim”o
);

367 
¡©us
 = 
	`g_­¶iÿtiÚ_run
 (
	`G_APPLICATION
 (
­p
), 
¬gc
, 
¬gv
);

368 
	`g_objeù_uÄef
 (
­p
);

370 
‹mp
 = 
pB®l1
;

371 
pB®l1
 = 
NULL
;

372 
	`¦“p
(1);

373 
	`b®l_de¡roy
(
‹mp
);

375  
¡©us
;

376 
	}
}

	@ball.c

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<m©h.h
>

6 
	~"glob®.h
"

7 
	~"b®l.h
"

9 
	$b®l_g‘Radius
(
T_BALL
 *
pB®l
)

11 ià(!
pB®l
)

14  
pB®l
->
r
;

15 
	}
}

17 
	$b®l_£tRadius
(
T_BALL
 *
pB®l
, 
r
)

19 ià(!
pB®l
)

22 
pB®l
->
r
 =„;

23 
	}
}

25 
	$b®l_g‘Pos
(
T_BALL
 *
pB®l
, *
px
, *
py
)

27 ià(!
pB®l
)

30 *
px
 = 
pB®l
->
x
;

31 *
py
 = 
pB®l
->
y
;

32 
	}
}

34 
T_SPEED
 
	$b®l_g‘S³ed
(
T_BALL
 *
pB®l
)

36 
T_SPEED
 
¥“d
;

38 ià(!
pB®l
)

39  
¥“d
;

41 
¥“d
.
xS³ed
 = 
pB®l
->speed.xSpeed;

42 
¥“d
.
yS³ed
 = 
pB®l
->speed.ySpeed;

44  
¥“d
;

45 
	}
}

47 
	$b®l_£tS³ed
(
T_BALL
 *
pB®l
, 
T_SPEED
 
¥“d
)

49 ià(!
pB®l
)

52 
pB®l
->
¥“d
.
xS³ed
 = speed.xSpeed;

53 
pB®l
->
¥“d
.
yS³ed
 = speed.ySpeed;

54 
	}
}

57 
	$b®l_show
(
T_BALL
 *
pB®l
, 
ÿœo_t
 *
pCR
)

59 ià(!
pB®l
 || !
pCR
)

62 
	`ÿœo_£t_sourû_rgb
(
pCR
, 
	`CLR_FETCHR
(
pB®l
->
þr
), 
	`CLR_FETCHG
ÕB®l->þr), 
	`CLR_FETCHB
(pBall->clr));

63 
	`ÿœo_£t_lše_width
 (
pCR
, 
pB®l
->
width
);

65 
	`ÿœo_¬c
 (
pCR
, 
pB®l
->
x
,…B®l->
y
,…B®l->
r
, 0, 2 * 
M_PI
);

66 
	`ÿœo_¡roke
 (
pCR
);

67 
	}
}

70 
	$b®l_»äesh
(
T_BALL
 *
pB®l
, 
ÿœo_t
 *
pCR
, 
wšWidth
, 
wšHeight
)

72 
	`b®l_move
(
pB®l
, 
wšWidth
, 
wšHeight
);

73 
	`b®l_show
(
pB®l
, 
pCR
);

74 
	}
}

77 
	$b®l_move
(
T_BALL
 *
pB®l
, 
wšWidth
, 
wšHeight
)

79 
Þdþr
;

81 ià(!
pB®l
)

84 
pB®l
->
x
 +ðpB®l->
¥“d
.
xS³ed
;

85 ià(
pB®l
->
x
 <…B®l->
r
)

87 
pB®l
->
x
 = 2*pB®l->
r
 -…Ball->x;

88 
pB®l
->
¥“d
.
xS³ed
 = -pBall->speed.xSpeed;

91 ià(
pB®l
->
x
 > 
wšWidth
 -…B®l->
r
)

93 
pB®l
->
x
 = 2*
wšWidth
 -…B®l->x - 2*pB®l->
r
;

94 
pB®l
->
¥“d
.
xS³ed
 = -pBall->speed.xSpeed;

97 
pB®l
->
y
 +ðpB®l->
¥“d
.
yS³ed
;

98 ià(
pB®l
->
y
 <…B®l->
r
)

100 
pB®l
->
y
 = 2*pB®l->
r
 -…Ball->y;

101 
pB®l
->
¥“d
.
yS³ed
 = -pBall->speed.ySpeed;

104 ià(
pB®l
->
y
 > 
wšHeight
 -…B®l->
r
)

106 
pB®l
->
y
 = 2*
wšHeight
 -…B®l->y - 2*pB®l->
r
;

107 
pB®l
->
¥“d
.
yS³ed
 = -pBall->speed.ySpeed;

109 
	}
}

112 
	$b®l_addS³ed
(
T_BALL
 *
pB®l
, 
xS³ed
, 
yS³ed
)

114 
pB®l
->
¥“d
.
xS³ed
 += xSpeed;

115 
pB®l
->
¥“d
.
yS³ed
 += ySpeed;

116 
	}
}

119 
T_BALL
 *
	$b®l_š™
(
x
, 
y
, 
r
, 
þr
)

121 
T_BALL
 *
pB®l
;

123 
pB®l
 = 
	`m®loc
((
T_BALL
));

125 
pB®l
->
x
 = x;

126 
pB®l
->
y
 = y;

127 
pB®l
->
r
 =„;

128 
pB®l
->
þr
 = clr;

129 
pB®l
->
width
 = 2;

130 
pB®l
->
¥“d
.
xS³ed
 = 
	`¿nd
()%20-10;

131 
pB®l
->
¥“d
.
yS³ed
 = 
	`¿nd
()%20-10;

133  
pB®l
;

134 
	}
}

137 
	$b®l_de¡roy
(
T_BALL
 *
pB®l
)

139 
	`ä“
(
pB®l
);

140 
	}
}

143 
	$b®l_£tCÌ
(
T_BALL
 *
pB®l
, 
þr
)

145 
pB®l
->
þr
 = clr;

146 
	}
}

149 
	$b®l_£tWidth
(
T_BALL
 *
pB®l
, 
width
)

151 
pB®l
->
width
 = width;

152 
	}
}

	@ball.h

2 
	~<gtk/gtk.h
>

4 
	s_BALL
{

5 
	mx
, 
	my
, 
	mr
;

6 
	mwidth
;

7 
T_SPEED
 
	m¥“d
;

8 
	mþr
;

9 } 
	tT_BALL
;

11 
b®l_£tRadius
(
T_BALL
 *
pB®l
, 
r
);

12 
b®l_g‘Radius
(
T_BALL
 *
pB®l
);

14 
b®l_g‘Pos
(
T_BALL
 *
pB®l
, *
px
, *
py
);

16 
T_SPEED
 
b®l_g‘S³ed
(
T_BALL
 *
pB®l
);

18 
b®l_£tS³ed
(
T_BALL
 *
pB®l
, 
T_SPEED
 
¥“d
);

21 
b®l_show
(
T_BALL
 *
pB®l
, 
ÿœo_t
 *
pCR
);

24 
b®l_»äesh
(
T_BALL
 *
pB®l
, 
ÿœo_t
 *
pCR
, 
wšWidth
, 
wšHeight
);

27 
b®l_move
(
T_BALL
 *
pB®l
, 
wšWidth
, 
wšHeight
);

30 
b®l_addS³ed
(
T_BALL
 *
pB®l
, 
xS³ed
, 
yS³ed
);

33 
T_BALL
 *
b®l_š™
(
x
, 
y
, 
r
, 
þr
);

36 
b®l_de¡roy
(
T_BALL
 *
pB®l
);

39 
b®l_£tCÌ
(
T_BALL
 *
pB®l
, 
þr
);

42 
b®l_£tWidth
(
T_BALL
 *
pB®l
, 
width
);

	@data.c

3 
	~<¡dlib.h
>

4 
	~<m©h.h
>

5 
	~"glob®.h
"

6 
	~"b®l.h
"

7 
	~"d©a.h
"

9 
	#MAX_BALL_NUM
 10

	)

11 
T_BALL
 *
	gb®lA¼ay
[
MAX_BALL_NUM
]={
NULL
};

12 
gboÞ—n
 
	gruÂšg
 = 
TRUE
;

14 
	$d©a_š™
()

16 
i
;

18 
i
=0; i<
MAX_BALL_NUM
; i++)

20 ià(!
b®lA¼ay
[
i
])

21 
b®lA¼ay
[
i
] = 
	`b®l_š™
(
	`¿nd
()%200,„ªd()%200, 30, 
	`CLR_RGB
(rand()%256,rand()%256,rand()%256));

25 
	`b®l_£tCÌ
(
b®lA¼ay
[0], 
	`CLR_RGB
(255,255,0));

26 
	`b®l_£tCÌ
(
b®lA¼ay
[1], 
	`CLR_RGB
(0,0,255));

28 
	`b®l_£tCÌ
(
b®lA¼ay
[2], 
	`CLR_RGB
(255,0,128));

29 
	}
}

31 
	$cÞlisiÚ
(
b®l0
, 
b®l1
, 
wšWidth
, 
wšHeight
)

33 
mode
;

34 
x
[2],
y
[2],
r
[2];

35 
T_SPEED
 
s
[2], 
cs
, 
ps
;

36 
xx
,
yy
,
¼
,
cs0
,
ps0
,
cs1
,
ps1
,
cx0
,
cx1
,
px0
,
px1
,
cy0
,
cy1
,
py0
,
py1
,
tmp
;

38 
r
[0] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
b®l0
]);

39 
r
[1] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
b®l1
]);

40 
	`b®l_g‘Pos
(
b®lA¼ay
[
b®l0
], &(
x
[0]), &(
y
[0]));

41 
	`b®l_g‘Pos
(
b®lA¼ay
[
b®l1
], &(
x
[1]), &(
y
[1]));

43 
s
[0] = 
	`b®l_g‘S³ed
(
b®lA¼ay
[
b®l0
]);

44 
s
[1] = 
	`b®l_g‘S³ed
(
b®lA¼ay
[
b®l1
]);

46 
xx
 = 
	`abs
(
x
[0] - x[1]);

47 
yy
 = 
	`abs
(
y
[0] - y[1]);

48 
	`´štf
("pow(%f,0.5)", 
xx
*xx+
yy
*yy);

49 
¼
 = 
	`pow
(
xx
*xx+
yy
*yy,0.5);

51 ià((
x
[0]-x[1]>0 && 
y
[0]-y[1]>0)

52 || (
x
[0]-x[1]<0 && 
y
[0]-y[1]<0))

53 
mode
 = 0;

55 
mode
 = 1;

59 
cx0
 = 
xx
*
s
[0].
xS³ed
/
¼
;

60 ià(
mode
)

62 
px0
 = 
yy
*
s
[0].
xS³ed
/
¼
;

63 
cy0
 = -
yy
*
s
[0].
yS³ed
/
¼
;

67 
px0
 = -
yy
*
s
[0].
xS³ed
/
¼
;

68 
cy0
 = 
yy
*
s
[0].
yS³ed
/
¼
;

70 
py0
 = 
xx
*
s
[0].
yS³ed
/
¼
;

71 
cs0
 = 
cx0
 + 
cy0
;

72 
ps0
 = 
px0
 + 
py0
;

74 
cx1
 = 
xx
*
s
[1].
xS³ed
/
¼
;

75 ià(
mode
)

77 
px1
 = 
yy
*
s
[1].
xS³ed
/
¼
;

78 
cy1
 = -
yy
*
s
[1].
yS³ed
/
¼
;

82 
px1
 = -
yy
*
s
[1].
xS³ed
/
¼
;

83 
cy1
 = 
yy
*
s
[1].
yS³ed
/
¼
;

85 
py1
 = 
xx
*
s
[1].
yS³ed
/
¼
;

86 
cs1
 = 
cx1
 + 
cy1
;

87 
ps1
 = 
px1
 + 
py1
;

89 
tmp
 = 
cs0
;

90 
cs0
 = 
cs1
;

91 
cs1
 = 
tmp
;

95 ià(
mode
)

97 
cs
.
xS³ed
 = 
xx
*
cs0
/
¼
;

98 
cs
.
yS³ed
 = -
yy
*
cs0
/
¼
;

99 
ps
.
xS³ed
 = 
yy
*
ps0
/
¼
;

100 
ps
.
yS³ed
 = 
xx
*
ps0
/
¼
;

104 
cs
.
xS³ed
 = 
yy
*
cs0
/
¼
;

105 
cs
.
yS³ed
 = 
xx
*
cs0
/
¼
;

106 
ps
.
xS³ed
 = -
yy
*
ps0
/
¼
;

107 
ps
.
yS³ed
 = 
xx
*
ps0
/
¼
;

109 
s
[0].
xS³ed
 = 
cs
.xS³ed + 
ps
.xSpeed;

110 
s
[0].
yS³ed
 = 
cs
.yS³ed + 
ps
.ySpeed;

111 
	`b®l_£tS³ed
(
b®lA¼ay
[
b®l0
], 
s
[0]);

113 ià(
mode
)

115 
cs
.
xS³ed
 = 
xx
*
cs1
/
¼
;

116 
cs
.
yS³ed
 = -
yy
*
cs1
/
¼
;

117 
ps
.
xS³ed
 = 
yy
*
ps1
/
¼
;

118 
ps
.
yS³ed
 = 
xx
*
ps1
/
¼
;

122 
cs
.
xS³ed
 = 
yy
*
cs1
/
¼
;

123 
cs
.
yS³ed
 = 
xx
*
cs1
/
¼
;

124 
ps
.
xS³ed
 = -
yy
*
ps1
/
¼
;

125 
ps
.
yS³ed
 = 
xx
*
ps1
/
¼
;

127 
s
[1].
xS³ed
 = 
cs
.xS³ed + 
ps
.xSpeed;

128 
s
[1].
yS³ed
 = 
cs
.yS³ed + 
ps
.ySpeed;

129 
	`b®l_£tS³ed
(
b®lA¼ay
[
b®l1
], 
s
[1]);

131 
¼
<
r
[0]+r[1])

133 
	`b®l_move
(
b®lA¼ay
[
b®l0
], 
wšWidth
, 
wšHeight
);

134 
	`b®l_move
(
b®lA¼ay
[
b®l1
], 
wšWidth
, 
wšHeight
);

136 
r
[0] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
b®l0
]);

137 
r
[1] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
b®l1
]);

138 
	`b®l_g‘Pos
(
b®lA¼ay
[
b®l0
], &(
x
[0]), &(
y
[0]));

139 
	`b®l_g‘Pos
(
b®lA¼ay
[
b®l1
], &(
x
[1]), &(
y
[1]));

141 
xx
 = 
	`abs
(
x
[0] - x[1]);

142 
yy
 = 
	`abs
(
y
[0] - y[1]);

143 
	`´štf
("2.pow(%f,0.5)", 
xx
*xx+
yy
*yy);

144 
¼
 = 
	`pow
(
xx
*xx+
yy
*yy,0.5);

148 
	`´štf
("CÞlisiÚ[%d,%d]...\r\n",
b®l0
,
b®l1
);

149 
	}
}

151 
	$sÿnR–©iÚ
(
wšWidth
, 
wšHeight
)

153 
i
,
j
;

154 
x
[2],
y
[2],
r
[2];

155 
xl
,
yl
,
¾
;

157 
i
=0; i<
MAX_BALL_NUM
-1; i++)

159 
j
=
i
+1; j<
MAX_BALL_NUM
; j++)

161 
r
[0] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
i
]);

162 
r
[1] = 
	`b®l_g‘Radius
(
b®lA¼ay
[
j
]);

163 
	`b®l_g‘Pos
(
b®lA¼ay
[
i
], &(
x
[0]), &(
y
[0]));

164 
	`b®l_g‘Pos
(
b®lA¼ay
[
j
], &(
x
[1]), &(
y
[1]));

166 
xl
 = 
x
[0] - x[1];

167 
yl
 = 
y
[0] - y[1];

168 
¾
 = 
r
[0] +„[1];

171 ià(
xl
*xl+
yl
*yÈ< 
¾
*rl)

172 
	`cÞlisiÚ
(
i
, 
j
, 
wšWidth
, 
wšHeight
);

175 
	}
}

177 
gboÞ—n
 
	$»äesh_®l
(
ÿœo_t
 *
pCR
, 
wšWidth
, 
wšHeight
)

179 
i
;

181 
	`sÿnR–©iÚ
(
wšWidth
, 
wšHeight
);

182 
i
=0; i<
MAX_BALL_NUM
; i++)

184 ià(
b®lA¼ay
[
i
])

185 
	`b®l_»äesh
(
b®lA¼ay
[
i
], 
pCR
, 
wšWidth
, 
wšHeight
);

188  
ruÂšg
;

189 
	}
}

191 
	$d©a_de¡roy
()

193 
i
;

195 
i
=0; i<
MAX_BALL_NUM
; i++)

197 ià(
b®lA¼ay
[
i
])

199 
	`b®l_de¡roy
(
b®lA¼ay
[
i
]);

200 
b®lA¼ay
[
i
] = 
NULL
;

203 
	}
}

205 
gboÞ—n
 
	$Ú_key_´ess
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tKey
 *
ev’t
, 
gpoš‹r
 
u£r_d©a
)

207 
	`´štf
("Key…»s£d: %d\r\n", 
ev’t
->
keyv®
);

209 ià(!
b®lA¼ay
[0])

210  
FALSE
;

213 ià(
ev’t
->
keyv®
 == 65362)

214 
	`b®l_addS³ed
(
b®lA¼ay
[0], 0, -1);

217 ià(
ev’t
->
keyv®
 == 65364)

218 
	`b®l_addS³ed
(
b®lA¼ay
[0], 0, 1);

221 ià(
ev’t
->
keyv®
 == 65361)

222 
	`b®l_addS³ed
(
b®lA¼ay
[0], -1, 0);

225 ià(
ev’t
->
keyv®
 == 65363)

226 
	`b®l_addS³ed
(
b®lA¼ay
[0], 1, 0);

228 ià(
ev’t
->
keyv®
 == 46)

229 
	`b®l_£tCÌ
(
b®lA¼ay
[0], 
	`CLR_RGB
(
	`¿nd
()%256,rand()%256,rand()%256));

231 ià(
ev’t
->
keyv®
 == 113)

232 
ruÂšg
 = 
FALSE
;

234  
TRUE
;

235 
	}
}

	@data.h

3 
	~<gtk/gtk.h
>

5 
d©a_š™
();

6 
d©a_de¡roy
();

8 
gboÞ—n
 
»äesh_®l
(
ÿœo_t
 *
pCR
, 
wšWidth
, 
wšHeight
);

9 
gboÞ—n
 
Ú_key_´ess
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tKey
 *
ev’t
, 
gpoš‹r
 
u£r_d©a
);

	@global.h

3 
	#CLR_RGB
(
R
,
G
,
B
è()((R&0xFF)<<16|(G&0xFF)<<8|(B&0xFF))

	)

4 
	#CLR_FETCHR
(
þr
è()(((þr>>16)&0xFF)/255.0)

	)

5 
	#CLR_FETCHG
(
þr
è()(((þr>>8)&0xFF)/255.0)

	)

6 
	#CLR_FETCHB
(
þr
è()((þr&0xFF)/255.0)

	)

8 
	s_SPEED
{

9 
	mxS³ed
, 
	myS³ed
;

10 } 
	tT_SPEED
;

	@playcoding.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~"d©a.h
"

4 
	~"wšdows.h
"

6 
	$maš
 (
¬gc
, **
¬gv
)

8 
GtkAµliÿtiÚ
 *
­p
;

9 
¡©us
;

11 
­p
 = 
	`gtk_­¶iÿtiÚ_Ãw
 ("Üg.gtk.exam¶e", 
G_APPLICATION_FLAGS_NONE
);

12 
	`g_sigÇl_cÚÃù
 (
­p
, "aùiv©e", 
	`G_CALLBACK
 (
aùiv©e
), 
NULL
);

14 
	`d©a_š™
();

16 
¡©us
 = 
	`g_­¶iÿtiÚ_run
 (
	`G_APPLICATION
 (
­p
), 
¬gc
, 
¬gv
);

17 
	`g_objeù_uÄef
 (
­p
);

19 
	`¦“p
(1);

20 
	`d©a_de¡roy
();

22  
¡©us
;

23 
	}
}

	@windows.c

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<gtk/gtk.h
>

6 
	~<sigÇl.h
>

7 
	~<time.h
>

8 
	~<sys/time.h
>

9 
	~<m©h.h
>

10 
	~"wšdows.h
"

11 
	~"d©a.h
"

13 
GtkWidg‘
 *
	gpD¿w
 = 
NULL
;

15 
ÿœo_surçû_t
 *
	gpSurçû
 = 
NULL
;

17 
	$þ—r_surçû
 ()

19 
ÿœo_t
 *
ü
;

21 ià(!
pSurçû
)

24 
ü
 = 
	`ÿœo_ü—‹
 (
pSurçû
);

26 
	`ÿœo_£t_sourû_rgb
 (
ü
, 1, 1, 1);

27 
	`ÿœo_·št
 (
ü
);

29 
	`ÿœo_de¡roy
 (
ü
);

30 
	}
}

33 
gboÞ—n
 
	$cÚfigu»_ev’t_cb
 (
GtkWidg‘
 *
widg‘
,

34 
GdkEv’tCÚfigu»
 *
ev’t
,

35 
gpoš‹r
 
d©a
)

51  
TRUE
;

52 
	}
}

58 
gboÞ—n
 
	$d¿w_cb
 (
GtkWidg‘
 *
widg‘
,

59 
ÿœo_t
 *
ü
,

60 
gpoš‹r
 
d©a
)

62 
	`ÿœo_£t_sourû_surçû
 (
ü
, 
pSurçû
, 0, 0);

63 
	`ÿœo_·št
 (
ü
);

65  
FALSE
;

66 
	}
}

69 
	$d¿w_brush
 (
GtkWidg‘
 *
widg‘
,

70 
gdoubË
 
x
,

71 
gdoubË
 
y
)

73 
ÿœo_t
 *
ü
;

78 
ü
 = 
	`ÿœo_ü—‹
 (
pSurçû
);

81 
	`ÿœo_£t_sourû_rgb
(
ü
, 0.0, 0.0, 1.0);

85 
	`ÿœo_£t_lše_width
 (
ü
, 2);

89 
	`ÿœo_¬c
 (
ü
, 
x
, 
y
, 10, 0, 2 * 
M_PI
);

90 
	`ÿœo_¡roke
 (
ü
);

95 
	`ÿœo_de¡roy
 (
ü
);

98 
	`gtk_widg‘_queue_d¿w_¬—
 (
widg‘
, 
x
 - 40, 
y
 - 40, 80, 80);

99 
	}
}

106 
gboÞ—n
 
	$bu‰Ú_´ess_ev’t_cb
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tBu‰Ú
 *
ev’t
,

107 
gpoš‹r
 
d©a
)

110  
TRUE
;

112 ià(
pSurçû
 =ð
NULL
)

113  
FALSE
;

115 ià(
ev’t
->
bu‰Ú
 =ð
GDK_BUTTON_PRIMARY
)

117 
	`d¿w_brush
 (
widg‘
, 
ev’t
->
x
,ƒv’t->
y
);

119 ià(
ev’t
->
bu‰Ú
 =ð
GDK_BUTTON_SECONDARY
)

121 
	`þ—r_surçû
();

122 
	`gtk_widg‘_queue_d¿w
 (
widg‘
);

126  
TRUE
;

127 
	}
}

133 
gboÞ—n
 
	$mÙiÚ_nÙify_ev’t_cb
 (
GtkWidg‘
 *
widg‘
,

134 
GdkEv’tMÙiÚ
 *
ev’t
,

135 
gpoš‹r
 
d©a
)

137  
TRUE
;

140 ià(
pSurçû
 =ð
NULL
)

141  
FALSE
;

143 ià(
ev’t
->
¡©e
 & 
GDK_BUTTON1_MASK
)

144 
	`d¿w_brush
 (
widg‘
, 
ev’t
->
x
,ƒv’t->
y
);

147  
TRUE
;

148 
	}
}

150 
	$þo£_wšdow
 ()

152 ià(
pSurçû
)

153 
	`ÿœo_surçû_de¡roy
 (
pSurçû
);

154 
pSurçû
 = 
NULL
;

156 
	`gtk_maš_qu™
 ();

157 
	}
}

159 
	$sigroutše
(
signo
)

161 
ÿœo_surçû_t
 *
lSurçû
;

162 
wšWidth
, 
wšHeight
;

163 
ÿœo_t
 *
ü
;

165 
wšWidth
 = 
	`gtk_widg‘_g‘_®loÿ‹d_width
 (
pD¿w
);

166 
wšHeight
 = 
	`gtk_widg‘_g‘_®loÿ‹d_height
 (
pD¿w
);

167 ià(
wšWidth
 < 1 || 
wšHeight
 < 1)

170 ià(
signo
 !ð
SIGALRM
)

177 
lSurçû
 = 
	`gdk_wšdow_ü—‹_simž¬_surçû
 (
	`gtk_widg‘_g‘_wšdow
 (
pD¿w
),

178 
CAIRO_CONTENT_COLOR
,

179 
wšWidth
,

180 
wšHeight
);

183 
ü
 = 
	`ÿœo_ü—‹
 (
lSurçû
);

188 
	`»äesh_®l
(
ü
, 
wšWidth
, 
wšHeight
);

190 
	`ÿœo_de¡roy
 (
ü
);

192 
	`gtk_widg‘_queue_d¿w
 (
pD¿w
);

194 ià(
pSurçû
)

195 
	`ÿœo_surçû_de¡roy
 (
pSurçû
);

196 
pSurçû
 = 
lSurçû
;

198 
	}
}

200 
	$aùiv©e
 (
GtkAµliÿtiÚ
 *
­p
, 
gpoš‹r
 
u£r_d©a
)

202 
GtkWidg‘
 *
wšdow
;

203 
GtkWidg‘
 *
äame
;

204 
™im”v®
 
tim”v
, 
tim”o
;

206 
wšdow
 = 
	`gtk_­¶iÿtiÚ_wšdow_Ãw
 (
­p
);

207 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
wšdow
), "Drawing Area");

209 
	`g_sigÇl_cÚÃù
 (
wšdow
, "de¡roy", 
	`G_CALLBACK
 (
þo£_wšdow
), 
NULL
);

210 
	`g_sigÇl_cÚÃù
 (
wšdow
, "key_´ess_ev’t", 
	`G_CALLBACK
 (
Ú_key_´ess
), 
NULL
);

212 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
wšdow
), 4);

214 
äame
 = 
	`gtk_äame_Ãw
 (
NULL
);

215 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame
), 
GTK_SHADOW_IN
);

216 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
wšdow
), 
äame
);

218 
pD¿w
 = 
	`gtk_d¿wšg_¬—_Ãw
 ();

220 
	`gtk_widg‘_£t_size_»que¡
 (
pD¿w
, 800, 600);

222 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame
), 
pD¿w
);

225 
	`g_sigÇl_cÚÃù
 (
pD¿w
, "draw",

226 
	`G_CALLBACK
 (
d¿w_cb
), 
NULL
);

227 
	`g_sigÇl_cÚÃù
 (
pD¿w
,"configure-event",

228 
	`G_CALLBACK
 (
cÚfigu»_ev’t_cb
), 
NULL
);

231 
	`g_sigÇl_cÚÃù
 (
pD¿w
, "motion-notify-event",

232 
	`G_CALLBACK
 (
mÙiÚ_nÙify_ev’t_cb
), 
NULL
);

233 
	`g_sigÇl_cÚÃù
 (
pD¿w
, "button-press-event",

234 
	`G_CALLBACK
 (
bu‰Ú_´ess_ev’t_cb
), 
NULL
);

241 
	`gtk_widg‘_£t_ev’ts
 (
pD¿w
, 
	`gtk_widg‘_g‘_ev’ts
 (pDraw)

242 | 
GDK_BUTTON_PRESS_MASK


243 | 
GDK_POINTER_MOTION_MASK
);

245 
	`sigÇl
(
SIGALRM
, 
sigroutše
);

246 
tim”v
.
™_v®ue
.
tv_£c
 = 0;

247 
tim”v
.
™_v®ue
.
tv_u£c
 = 40000;

248 
tim”v
.
™_š‹rv®
.
tv_£c
 = 0;

249 
tim”v
.
™_š‹rv®
.
tv_u£c
 = 40000;

250 
	`£t™im”
(
ITIMER_REAL
, &
tim”v
, &
tim”o
);

252 
	`gtk_widg‘_show_®l
 (
wšdow
);

253 
	}
}

	@windows.h

3 
aùiv©e
 (
GtkAµliÿtiÚ
 *
­p
, 
gpoš‹r
 
u£r_d©a
);

	@
1
.
0
9
77
back.c
ball.c
ball.h
data.c
data.h
global.h
playcoding.c
windows.c
windows.h
